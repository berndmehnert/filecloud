version: "3.9"

services:
fileserver:
image: filecloud/fileserver:latest
build:
context: ..
dockerfile: docker/Dockerfile
ports:
- "8080:8080"
volumes:
- filecloud-data:/data
environment:
- LISTEN_ADDR=:8080
- STORAGE_PATH=/data/storage
- DATABASE_URL=/data/files.db
- MAX_UPLOAD_SIZE=1073741824
# Uncomment and set for S3 usage (point to minio below for local dev)
# - S3_ENDPOINT=minio:9000
# - S3_ACCESS_KEY=minioadmin
# - S3_SECRET_KEY=minioadmin
# - S3_USE_SSL=0
depends_on:
- minio

minio:
image: minio/minio:latest
command: server /data
environment:
- MINIO_ROOT_USER=minioadmin
- MINIO_ROOT_PASSWORD=minioadmin
ports:
- "9000:9000"
- "9001:9001" # console
volumes:
- minio-data:/data

volumes:
filecloud-data:
minio-data:
